<form id="contact-form" class="space-y-6">
  <div>
    <label for="naam" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      Naam
    </label>
    <input
      type="text"
      id="naam"
      name="naam"
      placeholder="Je naam"
      class="mt-1 block w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 shadow-sm transition-colors focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-gray-600 dark:bg-gray-800 dark:text-white"
    />
  </div>

  <div>
    <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      E-mailadres
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      placeholder="je@email.nl"
      class="mt-1 block w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-gray-900 shadow-sm transition-colors focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-gray-600 dark:bg-gray-800 dark:text-white"
    />
    <p id="email-error" class="mt-1 hidden text-sm text-red-600"></p>
  </div>

  <div id="form-error" class="hidden rounded-lg bg-red-100 p-3 text-sm text-red-700 dark:bg-red-900/30 dark:text-red-400"></div>

  <button
    type="submit"
    id="submit-btn"
    class="inline-flex w-full items-center justify-center rounded-lg bg-primary-600 px-6 py-3 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
  >
    Neem contact op
  </button>

  <p class="text-xs text-gray-500 dark:text-gray-400">
    Je gegevens worden alleen gebruikt om contact met je op te nemen. Geen spam.
  </p>
</form>

<div id="form-success" class="hidden rounded-xl py-8 text-center">
  <div class="text-5xl">&#10003;</div>
  <h3 class="mt-4 text-xl font-bold text-gray-900 dark:text-white">Bedankt!</h3>
  <p class="mt-2 text-gray-600 dark:text-gray-300">We nemen snel contact met je op.</p>
</div>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;
  const formError = document.getElementById("form-error");
  const formSuccess = document.getElementById("form-success");
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;
  const emailInput = document.getElementById("email") as HTMLInputElement;
  const emailError = document.getElementById("email-error");

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  emailInput?.addEventListener("input", () => {
    emailError?.classList.add("hidden");
    emailInput.classList.remove("border-red-500");
  });

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    formError?.classList.add("hidden");
    emailError?.classList.add("hidden");

    const formData = new FormData(form);
    const email = (formData.get("email") as string) || "";
    const naam = (formData.get("naam") as string) || "";

    if (!email || !emailRegex.test(email)) {
      if (emailError) {
        emailError.textContent = "Vul een geldig e-mailadres in";
        emailError.classList.remove("hidden");
      }
      emailInput?.classList.add("border-red-500");
      emailInput?.focus();
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = "Verzenden...";

    try {
      const response = await fetch("/api/subscribe", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, naam }),
      });

      const result = await response.json();

      if (result.success) {
        form.classList.add("hidden");
        formSuccess?.classList.remove("hidden");
      } else {
        if (formError) {
          formError.textContent = result.error || "Er ging iets mis. Probeer het later opnieuw.";
          formError.classList.remove("hidden");
        }
        submitBtn.disabled = false;
        submitBtn.textContent = "Neem contact op";
      }
    } catch {
      if (formError) {
        formError.textContent = "Er ging iets mis. Controleer je internetverbinding.";
        formError.classList.remove("hidden");
      }
      submitBtn.disabled = false;
      submitBtn.textContent = "Neem contact op";
    }
  });
</script>
